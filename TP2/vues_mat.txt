CREATE MATERIALIZED VIEW CLIENT_V as
Select CLIENT.NUM,TRUNC(Months_between(FACTURE.DATE_ETABLI,CLIENT.DATE_NAIS)/12) as AGE,
case 
    when (TRUNC(Months_between(FACTURE.DATE_ETABLI,CLIENT.DATE_NAIS)/12))<30 then '<30 ans'
    when (TRUNC(Months_between(FACTURE.DATE_ETABLI,CLIENT.DATE_NAIS)/12))<45 then '30-45 ans'
    when (TRUNC(Months_between(FACTURE.DATE_ETABLI,CLIENT.DATE_NAIS)/12))<60 then '45-60 ans'
    when (TRUNC(Months_between(FACTURE.DATE_ETABLI,CLIENT.DATE_NAIS)/12))>=60 then '>60 ans'
end as groupeAge,
CLIENT.SEXE, substr(CLIENT.ADRESSE,(instr(CLIENT.ADRESSE,',',1,2))+1,((instr(CLIENT.ADRESSE,',',1,3)-(instr(CLIENT.ADRESSE,',',1,2))))-1) as VILLE,
substr(CLIENT.ADRESSE,instr(CLIENT.ADRESSE,',',1,3)+1,LENGTH(CLIENT.ADRESSE)-1) as PAYS,
substr(substr(CLIENT.ADRESSE,(instr(CLIENT.ADRESSE,',',1,1))+1,((instr(CLIENT.ADRESSE,',',1,2)-(instr(CLIENT.ADRESSE,',',1,1))))-1),1,2) as CP
FROM CLIENT JOIN FACTURE ON CLIENT.NUM=FACTURE.CLIENT;



CREATE MATERIALIZED VIEW TEMPS_V as
SELECT FACTURE.DATE_ETABLI,to_char(FACTURE.DATE_ETABLI, 'DDD') as JOURANNEE, to_char(FACTURE.DATE_ETABLI, 'WW')as SEMAINEANNEE,extract(month from FACTURE.DATE_ETABLI) as MOIS, extract(year from FACTURE.DATE_ETABLI) as ANNEE 
FROM FACTURE,dual;


CREATE MATERIALIZED VIEW PRODUIT_V as
SELECT PRODUIT.NUM,
substr(PRODUIT.DESIGNATION,1,((instr(PRODUIT.DESIGNATION,'.',1,1))-1)) as NOM, substr(PRODUIT.DESIGNATION,(instr(PRODUIT.DESIGNATION,'.',1,1))+1,((instr(PRODUIT.DESIGNATION,'.',1,2)-(instr(PRODUIT.DESIGNATION,'.',1,1))))-1) as SOUSCATEGORIE,
case
    when (substr(PRODUIT.DESIGNATION,(instr(PRODUIT.DESIGNATION,'.',1,1))+1,((instr(PRODUIT.DESIGNATION,'.',1,2)-(instr(PRODUIT.DESIGNATION,'.',1,1))))-1)) is null then substr(PRODUIT.DESIGNATION,INSTR(PRODUIT.DESIGNATION,'.',1,1)+1,LENGTH(PRODUIT.DESIGNATION)-1)
    when (substr(PRODUIT.DESIGNATION,(instr(PRODUIT.DESIGNATION,'.',1,1))+1,((instr(PRODUIT.DESIGNATION,'.',1,2)-(instr(PRODUIT.DESIGNATION,'.',1,1))))-1)) is not null then substr(PRODUIT.DESIGNATION,INSTR(PRODUIT.DESIGNATION,'.',1,2)+1,LENGTH(PRODUIT.DESIGNATION)-1)
end as CATEGORIE
FROM PRODUIT;


CREATE MATERIALIZED VIEW PRIX_V as
SELECT PRIX_DATE.NUM, PRIX_DATE.PRIX, PRIX_DATE.REMISE
FROM PRIX_DATE;

CREATE MATERIALIZED VIEW FAIT_VENTE as
SELECT FACTURE.DATE_ETABLI as idTemps, LIGNE_FACTURE.PRODUIT as idProduit, FACTURE.CLIENT as idClient, LIGNE_FACTURE.ID_PRIX as idPrix, LIGNE_FACTURE.QTE as QUANTITE, LIGNE_FACTURE.QTE * PRIX_DATE.PRIX as CA
FROM FACTURE JOIN LIGNE_FACTURE ON FACTURE.NUM = LIGNE_FACTURE.FACTURE JOIN PRIX_DATE ON LIGNE_FACTURE.ID_PRIX = PRIX_DATE.NUM;